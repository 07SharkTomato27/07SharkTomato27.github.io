<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>勉強勉強勉強勉強勉強勉強勉強勉強勉強勉強勉強勉強勉強勉強勉強勉強勉強勉強勉強勉強勉強勉強勉強</title>
  <style>
    html, body {
      margin: 0; padding: 0; overflow: hidden;
      background-color: black;
      color: white;
      font-family: sans-serif;
      text-align: center;
      height: 100%;
    }
    #question-container {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
    }
    #bsod {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background-color: black;
      display: none;
      z-index: 9999;
    }
    #bsod img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
  </style>
</head>
<body>
  <div id="question-container">
    <h1>勉強しようね？？？？？？</h1>
    <p id="question"></p>
    <input type="text" id="answer" autocomplete="off" />
    <button onclick="checkAnswer()">答える</button>
    <p id="timer"></p>
  </div>
  <div id="bsod"><img src="image/red.png" alt="Red Screen" /></div>

  <script>
    let num1 = Math.floor(Math.random() * 50);
    let num2 = Math.floor(Math.random() * 50);
    let answer = num1 + num2;
    document.getElementById("question").textContent = `${num1} + ${num2} = ?`;

    let timeLeft = 10;
    const timer = document.getElementById("timer");
    timer.textContent = `残り時間: ${timeLeft}秒`;

    const countdown = setInterval(() => {
      timeLeft--;
      timer.textContent = `残り時間: ${timeLeft}秒`;
      if (timeLeft <= 0) {
        clearInterval(countdown);
        launchPopupAttack();
      }
    }, 1000);

    function checkAnswer() {
      const userAnswer = parseInt(document.getElementById("answer").value);
      if (userAnswer === answer) {
        window.close();
      } else {
        clearInterval(countdown);
        launchPopupAttack();
      }
    }

    function requestFullscreen(element) {
      if (element.requestFullscreen) {
        element.requestFullscreen();
      } else if (element.webkitRequestFullscreen) { /* Safari */
        element.webkitRequestFullscreen();
      } else if (element.msRequestFullscreen) { /* IE11 */
        element.msRequestFullscreen();
      }
    }

    function launchPopupAttack() {
      document.getElementById("question-container").style.display = "none";

      const popups = [];
      const width = 300;
      const height = 200;
      const screenW = window.screen.availWidth;
      const screenH = window.screen.availHeight;
      let count = 0;

      const popupStates = [];

      const interval = setInterval(() => {
        const left = Math.floor(Math.random() * (screenW - width));
        const top = Math.floor(Math.random() * (screenH - height));

        const popup = window.open("", "", `width=${width},height=${height},left=${left},top=${top}`);
        if (popup) {
          popup.document.write(`
            <html><head><title>何を四天王？？</title>
            <style>
              body {
                margin: 0;
                background-color: red;
                color: white;
                display: flex;
                justify-content: center;
                align-items: center;
                font-size: 24px;
                animation: flash 0.2s infinite;
                user-select:none;
              }
              @keyframes flash {
                0% { background-color: red; }
                50% { background-color: black; }
                100% { background-color: red; }
              }
            </style>
            </head>
            <body>何を四天王？</body></html>
          `);
          popup.document.close();

          const vx = (Math.random() * 20 - 10) || 5;
          const vy = (Math.random() * 20 - 10) || 5;

          popupStates.push({popup, x: left, y: top, vx, vy});
          popups.push(popup);
        }

        count++;
        if (count >= 50) {
          clearInterval(interval);

          let moveInterval = setInterval(() => {
            popupStates.forEach(p => {
              p.x += p.vx;
              p.y += p.vy;

              if (p.x <= 0) { p.x = 0; p.vx = -p.vx; }
              if (p.x >= screenW - width) { p.x = screenW - width; p.vx = -p.vx; }
              if (p.y <= 0) { p.y = 0; p.vy = -p.vy; }
              if (p.y >= screenH - height) { p.y = screenH - height; p.vy = -p.vy; }

              try {
                p.popup.moveTo(p.x, p.y);
              } catch(e) {}
            });
          }, 30);

          setTimeout(() => {
            clearInterval(moveInterval);
            popups.forEach(p => {
              if (!p.closed) p.close();
            });
            const bsod = document.getElementById("bsod");
            bsod.style.display = "block";
            requestFullscreen(bsod);
          }, 5000);
        }
      }, 100);
    }
  </script>
</body>
</html>
