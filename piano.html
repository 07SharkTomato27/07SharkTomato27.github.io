<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ピアノ</title>
  <style>
    body { margin: 0; background: #111; }
    .piano {
      display: flex;
      overflow-x: auto;
      height: 200px;
      position: relative;
    }
    .white {
      width: 40px;
      height: 100%;
      background: white;
      border: 1px solid #000;
      box-sizing: border-box;
      position: relative;
      z-index: 1;
    }
    .black {
      width: 25px;
      height: 120px;
      background: black;
      position: absolute;
      top: 0;
      margin-left: -12.5px;
      z-index: 2;
    }
  </style>
</head>
<body>
  <div class="piano" id="piano"></div>

  <script>
    const context = new (window.AudioContext || window.webkitAudioContext)();
    const piano = document.getElementById("piano");

    const notes = ["A", "A#", "B", "C", "C#", "D", "D#", "E", "F", "F#", "G", "G#"];
    const whiteNotes = ["C", "D", "E", "F", "G", "A", "B"];
    const blackNotes = ["C#", "D#", "", "F#", "G#", "A#", ""];

    let midiNote = 21; // A0
    for (let i = 0; i < 88; i++) {
      const freq = midiToFreq(midiNote);
      const name = notes[midiNote % 12];
      const octave = Math.floor(midiNote / 12) - 1;
      const label = name + octave;

      const key = document.createElement("div");
      key.className = "white";
      key.dataset.freq = freq;
      key.title = label;
      key.addEventListener("mousedown", () => playNote(freq));
      piano.appendChild(key);

      if (["C", "D", "F", "G", "A"].includes(name)) {
        const black = document.createElement("div");
        black.className = "black";
        black.dataset.freq = midiToFreq(midiNote + 1);
        black.title = notes[(midiNote + 1) % 12] + octave;
        black.addEventListener("mousedown", () => playNote(midiToFreq(midiNote + 1)));
        key.appendChild(black);
      }

      midiNote++;
    }

    function midiToFreq(n) {
      return 440 * Math.pow(2, (n - 69) / 12);
    }

    function playNote(freq) {
      const osc = context.createOscillator();
      const gain = context.createGain();
      osc.type = "sine";
      osc.frequency.value = freq;
      osc.connect(gain);
      gain.connect(context.destination);
      gain.gain.setValueAtTime(0.2, context.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.001, context.currentTime + 1.2);
      osc.start();
      osc.stop(context.currentTime + 1.2);
    }
  </script>
</body>
</html>
