<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ピアノ</title>
  <style>
    body { margin: 0; overflow: hidden; background: #222; }
    .key {
      position: absolute;
      bottom: 0;
      width: 40px;
      height: 200px;
      border: 1px solid #000;
      box-sizing: border-box;
      cursor: pointer;
      user-select: none;
    }
    .white { background: white; z-index: 1; }
    .black {
      background: black;
      width: 24px;
      height: 120px;
      z-index: 2;
    }
  </style>
</head>
<body>

<script>
const AudioContext = window.AudioContext || window.webkitAudioContext;
const audioCtx = new AudioContext();

function playNote(frequency) {
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();

  osc.type = 'sine'; // ピアノに近づけるには detune + gain envelope を調整
  osc.frequency.value = frequency;

  gain.gain.setValueAtTime(0.001, audioCtx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.5, audioCtx.currentTime + 0.01);
  gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 1.5);

  osc.connect(gain).connect(audioCtx.destination);
  osc.start();
  osc.stop(audioCtx.currentTime + 1.6);
}

const noteFreq = (note) => 440 * Math.pow(2, (note - 69) / 12); // MIDI -> Hz

const whiteNotes = [0, 2, 4, 5, 7, 9, 11]; // C, D, E, F, G, A, B
const blackOffsets = {
  1: true, 3: true, 6: true, 8: true, 10: true // C#, D#, F#, G#, A#
};

const totalWhite = 36;
const keyWidth = window.innerWidth / totalWhite;

let whiteIndex = 0;

for (let midi = 48; whiteIndex < totalWhite; midi++) {
  const noteInOctave = midi % 12;
  const isWhite = whiteNotes.includes(noteInOctave);
  const freq = noteFreq(midi);

  if (isWhite) {
    const key = document.createElement('div');
    key.className = 'key white';
    key.style.left = (whiteIndex * keyWidth) + 'px';
    key.style.width = keyWidth + 'px';
    key.onclick = () => playNote(freq);
    document.body.appendChild(key);
    whiteIndex++;
  } else {
    const black = document.createElement('div');
    black.className = 'key black';
    const pos = whiteIndex - 1 + 0.7;
    black.style.left = (pos * keyWidth - 12) + 'px';
    black.onclick = () => playNote(freq);
    document.body.appendChild(black);
  }
}
</script>

</body>
</html>
