<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>イルカ95クローン</title>
<style>
body{margin:0;height:100vh;font-family:sans-serif;background:url("image/95.png") center/cover no-repeat}
#assistant{position:fixed;right:24px;bottom:24px;width:220px;z-index:9999;user-select:none}
.shell{position:relative;width:100%;height:100%;display:flex;align-items:flex-end;justify-content:flex-end}
.dolphin{width:140px;height:140px;display:block;cursor:grab}
.bob{animation:bob 2200ms ease-in-out infinite}
@keyframes bob{0%{transform:translateY(0)}50%{transform:translateY(-8px)}100%{transform:translateY(0)}}
.bubble{position:absolute;right:160px;bottom:80px;max-width:320px;padding:10px 12px;border-radius:10px;background:#fff;color:#000;box-shadow:0 6px 18px rgba(0,0,0,.25);font-size:13px;line-height:1.2}
.bubble:after{content:"";position:absolute;right:-10px;bottom:14px;width:0;height:0;border-left:10px solid #fff;border-top:8px solid transparent;border-bottom:8px solid transparent}
.bubble.hidden{display:none}
.controls{position:absolute;right:8px;top:8px;display:flex;gap:6px}
.btn{width:22px;height:22px;border-radius:6px;display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,.9);box-shadow:0 2px 6px rgba(0,0,0,.18);cursor:pointer;font-weight:700;font-size:12px}
.small{width:16px;height:16px;border-radius:4px;font-size:11px}
.shadow{position:absolute;left:20px;bottom:8px;width:120px;height:24px;background:rgba(0,0,0,.12);border-radius:999px;filter:blur(6px);transform:scaleX(.9)}
#askBox{margin-top:6px;display:flex}
#askInput{flex:1;padding:2px 4px;font-size:12px}
#askBtn{margin-left:4px;padding:2px 6px;font-size:12px;cursor:pointer}
</style>
</head>
<body>
<div id="assistant">
  <div class="shell">
    <div class="shadow"></div>
    <img src="image/kairu.png" class="dolphin bob" id="dolphin">
  </div>
  <div class="bubble hidden" id="bubble">
    <div id="bubbleText"></div>
    <div id="askBox" style="display:none">
      <input id="askInput" type="text" placeholder="質問してみて">
      <button id="askBtn">聞く</button>
    </div>
  </div>
  <div class="controls" id="controls" style="display:none">
    <div class="btn" id="hide">×</div>
    <div class="btn small" id="min">–</div>
  </div>
</div>

<script>
const assistant=document.getElementById('assistant');
const dolphin=document.getElementById('dolphin');
const bubble=document.getElementById('bubble');
const bubbleText=document.getElementById('bubbleText');
const askBox=document.getElementById('askBox');
const askInput=document.getElementById('askInput');
const askBtn=document.getElementById('askBtn');
const controls=document.getElementById('controls');
let isDragging=false,dragOffsetX=0,dragOffsetY=0,autoTalk=true;
let phrases=["こんにちは！助けが必要？","ヒントがほしい？","何でも聞いて"];

function showBubble(text,ms=3000,ask=false){
  bubbleText.textContent=text;
  bubble.classList.remove('hidden');
  if(ask){askBox.style.display="flex"}else{askBox.style.display="none"}
  if(ms>0) setTimeout(()=>bubble.classList.add('hidden'),ms);
}
function rand(min,max){return Math.floor(Math.random()*(max-min+1))+min}
function scheduledTalk(){
  if(!autoTalk) return;
  let phrase=phrases[rand(0,phrases.length-1)];
  showBubble(phrase,3500,phrase.includes("聞いて"));
}
let talkTimer=setInterval(scheduledTalk,7000);
scheduledTalk();

askBtn.addEventListener('click',()=>{
  let q=askInput.value.trim();
  if(!q) return;
  askInput.value="";
  bubbleText.textContent="調べてるよ...";
  askBox.style.display="none";
  fetch("https://api.duckduckgo.com/?q="+encodeURIComponent(q)+"&format=json&no_redirect=1&no_html=1")
    .then(r=>r.json())
    .then(data=>{
      if(data.AbstractText){
        showBubble(data.AbstractText,8000);
      }else if(data.RelatedTopics && data.RelatedTopics.length>0 && data.RelatedTopics[0].Text){
        showBubble(data.RelatedTopics[0].Text,8000);
      }else{
        showBubble("ごめん、うまく答えが見つからなかった",4000);
      }
    })
    .catch(()=>{
      showBubble("検索に失敗した",3000);
    });
});

assistant.addEventListener('mousedown',e=>{
  if(e.target.closest('.btn')) return;
  isDragging=true;
  const rect=assistant.getBoundingClientRect();
  dragOffsetX=e.clientX-rect.right;
  dragOffsetY=e.clientY-rect.bottom;
});
window.addEventListener('mousemove',e=>{
  if(!isDragging) return;
  let x=window.innerWidth-(e.clientX-dragOffsetX)-assistant.offsetWidth;
  let y=window.innerHeight-(e.clientY-dragOffsetY)-assistant.offsetHeight;
  assistant.style.right=Math.max(6,Math.min(window.innerWidth-assistant.offsetWidth-6,x))+'px';
  assistant.style.bottom=Math.max(6,Math.min(window.innerHeight-assistant.offsetHeight-6,y))+'px';
});
window.addEventListener('mouseup',()=>{isDragging=false});

dolphin.addEventListener('dblclick',()=>{
  showBubble("おっと！ダブルクリックされたね",2500);
});

assistant.addEventListener('contextmenu',e=>{
  e.preventDefault();
  controls.style.display='flex';
  showBubble("オプションを表示中",1600);
});

document.getElementById('hide').addEventListener('click',()=>{
  assistant.remove();
  clearInterval(talkTimer);
});
document.getElementById('min').addEventListener('click',()=>{
  bubble.classList.toggle('hidden');
  dolphin.classList.toggle('bob');
});
</script>
</body>
</html>
