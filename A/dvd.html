<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>DVD</title>
<style>
:root{--bg:#000}
html,body{height:100%;margin:0}
body{background:var(--bg);overflow:hidden;font-family:sans-serif;color:#000}
#ui{position:fixed;left:8px;top:8px;z-index:9999;background:rgba(255,255,255,0.9);padding:10px;border-radius:6px;display:flex;gap:8px;align-items:center}
#layer{position:fixed;inset:0;z-index:10}
#bgframe{position:fixed;inset:0;width:100%;height:100%;border:none;z-index:0;display:none;pointer-events:none}
img.logo{position:absolute;width:200px;height:auto;will-change:transform}
button,input{font-size:14px;padding:6px;border-radius:4px}
</style>
</head>
<body>
<iframe id="bgframe"></iframe>
<div id="ui">
<input id="files" type="file" accept="image/*" multiple>
<input id="bg" type="color" value="#000000">
<input id="iframeUrl" type="text" placeholder="背景iframe URL">
<button id="startBtn">開始</button>
</div>
<div id="layer"></div>
<script>
const filesInput=document.getElementById('files')
const bgInput=document.getElementById('bg')
const iframeUrl=document.getElementById('iframeUrl')
const startBtn=document.getElementById('startBtn')
const ui=document.getElementById('ui')
const layer=document.getElementById('layer')
const bgframe=document.getElementById('bgframe')
let logos=[]
let raf=null
let running=false

bgInput.oninput=e=>{
  document.documentElement.style.setProperty('--bg',e.target.value)
  bgframe.style.display='none'
}

function fs(){
  const el=document.documentElement
  if(el.requestFullscreen)el.requestFullscreen().catch(()=>{})
}

function makeLogo(src){
  const img=document.createElement('img')
  img.src=src
  img.className='logo'
  layer.appendChild(img)
  img.onload=()=>{
    const w=200
    img.style.width=w+'px'
    const x=Math.random()*(innerWidth-w)
    const y=Math.random()*(innerHeight-img.height)
    img.style.transform=`translate(${x}px,${y}px)`
    const vx=(Math.random()*4+1)*(Math.random()<.5?-1:1)
    const vy=(Math.random()*4+1)*(Math.random()<.5?-1:1)
    logos.push({el:img,x,y,vx,vy,w,h:img.height})
  }
}

function addAll(list){
  for(const f of list){
    const url=URL.createObjectURL(f)
    makeLogo(url)
  }
}

function step(){
  const w=innerWidth,h=innerHeight
  for(const l of logos){
    l.x+=l.vx
    l.y+=l.vy
    if(l.x<=0){l.x=0;l.vx=Math.abs(l.vx)}
    if(l.x+l.w>=w){l.x=w-l.w;l.vx=-Math.abs(l.vx)}
    const bh=l.el.getBoundingClientRect().height
    if(l.y<=0){l.y=0;l.vy=Math.abs(l.vy)}
    if(l.y+bh>=h){l.y=h-bh;l.vy=-Math.abs(l.vy)}
    l.el.style.transform=`translate(${l.x}px,${l.y}px)`
  }
  raf=requestAnimationFrame(step)
}

startBtn.onclick=()=>{
  if(running)return
  running=true
  logos.forEach(l=>l.el.remove())
  logos=[]
  addAll(filesInput.files)
  const url=iframeUrl.value.trim()
  if(url){bgframe.src=url;bgframe.style.display='block'}
  else{bgframe.style.display='none'}
  fs()
  ui.style.display='none'
  document.body.focus()
  step()
}

window.onkeydown=e=>{
  if(!running)return
  if(e.code==='Space'){
    e.preventDefault()
    addAll(filesInput.files)
  }
  if(e.code==='KeyS'){
    for(const l of logos){
      const sx=Math.sign(l.vx)||1,sy=Math.sign(l.vy)||1
      l.vx+=sx
      l.vy+=sy
    }
  }
  if(e.code==='KeyD'){
    for(const l of logos){
      l.vx*=0.8
      l.vy*=0.8
    }
  }
  if(e.code==='Escape'){
    running=false
    cancelAnimationFrame(raf)
    ui.style.display='flex'
  }
}
</script>
</body>
</html>
