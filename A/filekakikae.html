<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ファイル書き換えツール</title>
<style>
html,body{
  margin:0;
  padding:0;
  width:100%;
  height:100%;
  background:#0b0e12;
  color:#e2e8f0;
  font-family:system-ui,monospace;
}
.container{
  display:flex;
  flex-direction:column;
  width:100%;
  height:100%;
  box-sizing:border-box;
  padding:10px;
  gap:10px;
}
.top{
  display:flex;
  align-items:center;
  gap:10px;
}
input[type=text]{
  background:#11151a;
  color:#e2e8f0;
  border:1px solid #222;
  border-radius:6px;
  padding:6px 10px;
  flex:1;
  font-family:monospace;
}
input[type=file]::file-selector-button,button{
  background:#1c2128;
  color:#e2e8f0;
  border:1px solid #333;
  border-radius:6px;
  padding:8px 16px;
  cursor:pointer;
  transition:0.2s;
}
input[type=file]::file-selector-button:hover,button:hover{
  background:#2a323c;
}
.editor{
  flex:1;
  display:flex;
  background:#11151a;
  border:1px solid #222;
  border-radius:8px;
  overflow:hidden;
}
.linenum{
  width:60px;
  background:#0f1318;
  color:#6a7b8c;
  text-align:right;
  padding:12px 10px;
  font-family:monospace;
  font-size:14px;
  line-height:1.5;
  white-space:pre;
  overflow:auto;
  user-select:none;
  box-sizing:border-box;
}

textarea{
  flex:1;
  width:100%;
  height:100%;
  resize:none;
  background:transparent;
  color:#e2e8f0;
  border:0;
  padding:12px;
  font-family:monospace;
  font-size:14px;
  outline:none;
  line-height:1.5;
  box-sizing:border-box;
}
</style>
</head>
<body>
<div class="container">
  <div class="top">
    <input type="file" id="fileInput" accept=".csv,.txt">
    <input type="text" id="fileName" placeholder="ファイル名">
    <button id="saveBtn">保存</button>
  </div>
  <div class="editor">
    <div class="linenum" id="lines">1</div>
    <textarea id="editor" placeholder="ファイルを開くとここに内容が表示されます"></textarea>
  </div>
</div>
<script>
const fileInput=document.getElementById("fileInput")
const editor=document.getElementById("editor")
const saveBtn=document.getElementById("saveBtn")
const fileName=document.getElementById("fileName")
const lines=document.getElementById("lines")
let currentFileName=""

fileInput.addEventListener("change",()=>{
  const file=fileInput.files[0]
  if(!file)return
  currentFileName=file.name
  fileName.value=currentFileName
  const reader=new FileReader()
  reader.onload=e=>{
    editor.value=e.target.result
    updateLines()
  }
  reader.readAsText(file)
})

editor.addEventListener("input",updateLines)
editor.addEventListener("scroll",()=>{lines.scrollTop=editor.scrollTop})

function updateLines(){
  const count = editor.value.split("\n").length;
  let out = "";
  for(let i=1;i<=count;i++){
    out += i + "\n";
  }
  lines.textContent = out;
}

editor.addEventListener("scroll", ()=>{ lines.scrollTop = editor.scrollTop; });


saveBtn.addEventListener("click",()=>{
  const name=fileName.value.trim()||"untitled.txt"
  const blob=new Blob([editor.value],{type:"text/plain"})
  const a=document.createElement("a")
  a.href=URL.createObjectURL(blob)
  a.download=name
  a.click()
})
</script>
</body>
</html>
